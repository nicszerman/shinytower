(function(){
var tree={};tree.clone=function(originalObject,circular){var propertyIndex,descriptor,keys,current,nextSource,indexOf,copies=[{source:originalObject,target:Object.create(Object.getPrototypeOf(originalObject))}],cloneObject=copies[0].target,sourceReferences=[originalObject],targetReferences=[cloneObject];while(current=copies.shift()){keys=Object.getOwnPropertyNames(current.source);for(propertyIndex=0;propertyIndex<keys.length;propertyIndex++){descriptor=Object.getOwnPropertyDescriptor(current.source,keys[propertyIndex]);if(!descriptor.value||typeof descriptor.value!=="object"){Object.defineProperty(current.target,keys[propertyIndex],descriptor);continue}nextSource=descriptor.value;descriptor.value=Array.isArray(nextSource)?[]:Object.create(Object.getPrototypeOf(nextSource));if(circular){indexOf=sourceReferences.indexOf(nextSource);if(indexOf!==-1){descriptor.value=targetReferences[indexOf];Object.defineProperty(current.target,keys[propertyIndex],descriptor);continue}sourceReferences.push(nextSource);targetReferences.push(descriptor.value)}Object.defineProperty(current.target,keys[propertyIndex],descriptor);copies.push({source:nextSource,target:descriptor.value})}}return cloneObject};(function(factory){if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){module.g=factory()}else{var OldCookies=window.Cookies;var api=window.Cookies=factory();api.h=function(){window.Cookies=OldCookies;return api}}})(function(){function extend(){var i=0;var result={};for(;i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes){result[key]=attributes[key]}}return result}function init(converter){function api(key,value,attributes){var result;if(typeof document==="undefined"){return}if(arguments.length>1){attributes=extend({path:"/"},api.i,attributes);if(typeof attributes.j==="number"){var expires=new Date;expires.setMilliseconds(expires.getMilliseconds()+attributes.j*864e5);attributes.j=expires}try{result=JSON.stringify(value);if(/^[\{\[]/.test(result)){value=result}}catch(e){}if(!converter.write){value=encodeURIComponent(String(value)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)}else{value=converter.write(value,key)}key=encodeURIComponent(String(key));key=key.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);key=key.replace(/[\(\)]/g,escape);return document.cookie=[key,"=",value,attributes.j&&"; expires="+attributes.j.toUTCString(),attributes.path&&"; path="+attributes.path,attributes.domain&&"; domain="+attributes.domain,attributes.secure?"; secure":""].join("")}if(!key){result={}}var cookies=document.cookie?document.cookie.split("; "):[];var rdecode=/(%[0-9A-Z]{2})+/g;var i=0;for(;i<cookies.length;i++){var parts=cookies[i].split("=");var cookie=parts.slice(1).join("=");if(cookie.charAt(0)==='"'){cookie=cookie.slice(1,-1)}try{var name=parts[0].replace(rdecode,decodeURIComponent);cookie=converter.read?converter.read(cookie,name):converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent);if(this.json){try{cookie=JSON.parse(cookie)}catch(e){}}if(key===name){result=cookie;break}if(!key){result[name]=cookie}}catch(e){}}return result}api.set=api;api.get=function(key){return api(key)};api.k=function(){return api.apply({json:true},[].slice.call(arguments))};api.i={};api.remove=function(key,attributes){api(key,"",extend(attributes,{j:-1}))};api.l=init;return api}return init(function(){})});function exit(status){var i,that=this,_addEvent=function(el,type,handler,capturing){if(el.addEventListener){el.addEventListener(type,handler,!!capturing)}else if(el.attachEvent){el.attachEvent("on"+type,handler)}else{el["on"+type]=handler}};_stopEvent=function(e){if(e.stopPropagation){e.stopPropagation();e.preventDefault()}else{that.window.event.cancelBubble=true;that.window.event.returnValue=false}};if(typeof status==="string"){alert(status)}_addEvent(this.window,"error",function(e){_stopEvent(e)},false);var handlers=["copy","cut","paste","beforeunload","blur","change","click","contextmenu","dblclick","focus","keydown","keypress","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","DOMNodeInserted","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMNodeInsertedIntoDocument","DOMAttrModified","DOMCharacterDataModified","DOMElementNameChanged","DOMAttributeNameChanged","DOMActivate","DOMFocusIn","DOMFocusOut","online","offline","textInput","abort","close","dragdrop","load","paint","reset","select","submit","unload"];for(i=0;i<handlers.length;i++){_addEvent(this.window,handlers[i],function(e){_stopEvent(e)},true)}if(this.window.stop){this.window.stop()}}function simulateKeydown(key){var e=$.Event("keydown");e.which=key;$(document).trigger(e)}function isNumber(value){return!isNaN(parseInt(value*1))}function toInt(val){return~~val}function sizeOf(object){bytes=0;function sizeOfRec(obj){if(obj!==null&&obj!==undefined){switch(typeof obj){case"number":bytes+=8;break;case"string":bytes+=obj.length*2;break;case"boolean":bytes+=4;break;case"object":var objClass=Object.prototype.toString.call(obj).slice(8,-1);if(objClass==="Object"||objClass==="Array"){for(var key in obj){if(!obj.hasOwnProperty(key))continue;sizeOfRec(obj[key])}}else bytes+=obj.toString().length*2;break}}return bytes}return sizeOfRec(object)}function fadeTextElement(text,duration){duration=duration||1e3;var element='<div style="font-family:   sans-serif; animation-name: fade;   animation-duration: '+duration/1e3+'s; animation-iteration-count:   infinite;">'+text+"</div>";return element}function prettyName(name){var arr=name.split("_");var disName="";for(var n=0;n<arr.length;n++){disName=disName+" "+arr[n][0].toUpperCase()+arr[n].substring(1)}disName=disName.substring(1);return disName}var char={level:0,m:0,attack:0,o:0,p:0,q:0,blue:0,red:0,s:0,t:0,u:{},floor:0,state:"char_front_rest",data:{},v:{}};var newChar=$.extend(true,{},char);var oldChar=$.extend(true,{},char);var GOD=false;var Core={};Core.A=function startGame(){keyAction={};specialItems=tree.clone(specialItemsBackUp,true);disableKeyboard();enableKeyboard();clearBoard();$("#display-fight").hide();$("#mob-screen").hide();$("#shop-container").hide();$("#dialog_warrior").hide();$("#dialog_item").hide();char.level=1;char.m=1e3;char.attack=10;char.o=10;char.B=0;char.p=0;char.q=0;char.blue=0;char.red=0;char.u=jQuery.extend(true,{},floors);char.floor=0;char.state="char_front_rest";char.data={C:0,D:0,F:1,G:{H:25,I:200,J:200},dialogs:{old_man_1:true,old_man_2:true,merchant_1:true,merchant_2:true,thief_1:true,thief_2:true,princess:true},K:{L:false},M:{N:false}};char.v={O:true};var newPos=indexToRowCol(char.u[char.floor].indexOf(99));char.s=newPos.s;char.t=newPos.t;newChar=$.extend(true,{},char);char.floor=-1;updateChar();if(GOD)godMode()};var keyAction={};function keyPressed(key){if(!KEYBOARD_ENABLED)return;key=Number(key);console.log("The key "+key+" was pressed.");console.log("The processed key "+Core.P(key)+" was pressed.");newChar=$.extend(true,{},char);switch(key){case 37:case 100:case 65:newChar.t--;newChar.state="char_left_walk";char.state="char_left_rest";setTimeout(function(){if(char.state!="char_left_walk")return;newChar.state="char_left_rest";updateChar()},110);break;case 39:case 102:case 68:newChar.t++;newChar.state="char_right_walk";char.state="char_right_rest";setTimeout(function(){if(char.state!="char_right_walk")return;newChar.state="char_right_rest";updateChar()},110);break;case 38:case 104:case 87:newChar.s--;newChar.state="char_back_walk";char.state="char_back_rest";setTimeout(function(){if(char.state!="char_back_walk")return;newChar.state="char_back_rest";updateChar()},110);break;case 40:case 98:case 83:newChar.s++;newChar.state="char_front_walk";char.state="char_front_rest";setTimeout(function(){if(char.state!="char_front_walk")return;newChar.state="char_front_rest";updateChar()},110);break;case 82:Messages.R();return;default:if(keyAction[key]!==undefined)keyAction[key]();return}if(newChar.t==0||newChar.t==12||newChar.s==0||newChar.s==12){newChar=$.extend(true,{},char);updateChar();return}var itemNumber=getTile(newChar.s,newChar.t);if(specialItems[itemNumber]!==undefined){specialItems[itemNumber].action()}updateChar()}function updateChar(){var hasChar=rowcolHasChar(char.s,char.t);var tile=$("#rowcol-"+char.s+"-"+char.t);tile.removeClass(hasChar);tile=$("#rowcol-"+newChar.s+"-"+newChar.t);tile.addClass(newChar.state);if(newChar.floor!=char.floor){fillFloor(newChar.u[newChar.floor]);if(char.floor!=-1)Music.S(newChar.floor,char.floor);else Music.S(newChar.floor)}$("#stat_level").text(newChar.level);$("#stat_life").text(newChar.m);$("#stat_attack").text(newChar.attack);$("#stat_defense").text(newChar.o);$("#stat_coins").text(newChar.B);$("#stat_experience").text(newChar.p);$("#stat_yellow").text(newChar.q);$("#stat_blue").text(newChar.blue);$("#stat_red").text(newChar.red);$("#stat_floor").text(newChar.floor);if(newChar.data.D<newChar.floor)newChar.data.D=newChar.floor;char=$.extend(true,{},newChar)}function fillFloor(floorArray){for(var i=floorArray.length-1;i>=0;i--){var rowcol=indexToRowCol(i);setTile(rowcol.s,rowcol.t,floorArray[i])}}function setTile(row,col,item){if(item===undefined&&isNumber(row)){item=col;row=indexToRowCol(row);col=row.t;row=row.s}var hasChar=rowcolHasChar(row,col);var tile=$("#rowcol-"+row+"-"+col);tile.removeClass();tile.addClass("tile").addClass(getItemName(item));if(hasChar!="")tile.addClass(hasChar);if(typeof item==="number"){var image='url("./res/image/'+getItemName(item)+'.gif")';if(getItemName(item)!="")tile.css("background-image",image);else tile.css("background-image",'url("./res/image/road.gif")')}if(typeof item==="string"){var image='url("./res/image/'+item+'.gif")';if(item!="")tile.css("background-image",image)}}function getTile(row,col){return char.u[char.floor][rowcolToIndex(row,col)]}function getItemName(itemNumber){switch(itemNumber){case 0:return"road";case 1:return"wall";case 19:return"lava";case 20:return"stars";default:if(specialItems[itemNumber]!==undefined){if(specialItems[itemNumber]["T"]!==undefined)return specialItems[itemNumber].T;if(specialItems[itemNumber]["getImageName"]!==undefined)return specialItems[itemNumber].getImageName();return specialItems[itemNumber].U}return""}}function rowcolHasChar(row,col){if(col===undefined){if(isNumber(row)){row=indexToRowCol(row);col=row.t;row=row.s}else{col=row.t;row=row.s}}var tile=$("#rowcol-"+row+"-"+col);var hasChar="";var indexOfChar=tile.attr("class").indexOf("char");if(indexOfChar>-1){while(tile.attr("class").charAt(indexOfChar)!=""&&tile.attr("class").charAt(indexOfChar)!=" ")indexOfChar++;hasChar=tile.attr("class").slice(tile.attr("class").indexOf("char"),indexOfChar)}return hasChar}function notify(message,duration){duration=duration||500;clearInterval(newChar.data.C);var name=$("#notification-container").css("animation-name");$("#notification-container").css("animation-name","");$("#notification-container").css("animation-name",name);$("#notification").text(message);$("#notification-container").css("animation-duration",duration/1e3+"s");$("#notification-container").css("display","flex");newChar.data.C=setTimeout(function(){$("#notification-container").css("display","none")},duration);char.data.C=newChar.data.C}function sendMessage(message,keydownFun){KEYBOARD_ENABLED=false;disableKeyboard();keydownFun=keydownFun||function(e){switch(Core.P(e.which)){case"enter":case"mobScreen":case"windCompass":case"holyWater":clearMessage();break}};enableKeyboard(keydownFun);message='<div style="width:100%;">'+message+"</div>";$("#message-container>#message").html(message);$("#message-container").show()}function clearMessage(){disableKeyboard();KEYBOARD_ENABLED=true;enableKeyboard();$("#message-container").hide()}function shop(main,opts){var $shop=$("#shop-container .flex-container").empty();$shop.append('<h5 id="main_text" class="text-flow"></h5>');var escaped=$shop.find("#main_text").text(main).text();$shop.find("#main_text").html(escaped.replace(/\n/g,"<br>"));for(var i=1;i<=opts.length;i++){var str='<div class="flex_item-'+i+'"><h5 id="option-'+i+'">'+opts[i-1]+"</h5></div>";$shop.append(str)}$shop.parent().show()}function godMode(){newChar.attack+=1e4;newChar.o+=1e4;newChar.q+=100;newChar.blue+=100;newChar.red+=100;newChar.B+=1e5;newChar.p+=1e5;newChar.data.D=21;specialItems[33].action();specialItems[34].action();specialItems[35].action();updateChar()}function fastForward(on){if(on){newChar.data.G.J=newChar.data.G.H}else{newChar.data.G.J=newChar.data.G.I}char.data.G.J=newChar.data.G.J}Core.V=function levelUp(character,levels){if(typeof character=="number"){levels=character;character=undefined}var obj=character||newChar;levels=levels||1;var x=0;while(x++<levels){obj.m+=150*Math.pow(obj.level,1/10);obj.m=toInt(obj.m);obj.m+=800;obj.attack+=7;obj.o+=7;obj.level++}if(character===undefined)updateChar();return obj};Core.P=function keyAdapter(key){switch(key){case 13:case 32:case 101:return"enter";case 37:case 65:case 100:return"left";case 39:case 68:case 102:return"right";case 38:case 87:case 104:return"up";case 40:case 83:case 98:return"down";case 27:return"esc";case 18:return"alt";case 9:return"tab";case 76:return"mobScreen";case 79:return"windCompass";case 85:return"holyWater"}var _to_ascii={188:"44",109:"45",190:"46",191:"47",192:"96",220:"92",222:"39",221:"93",219:"91",173:"45",187:"61",186:"59",189:"45"};var c=key;if(_to_ascii[c]){c=_to_ascii[c]}if(c>=65&&c<=90){c=String.fromCharCode(c+32)}else{c=String.fromCharCode(c)}return c};function indexToRowCol(index){return{s:Math.floor(index/11)+1,t:index%11+1}}function rowcolToIndex(row,col){if(typeof col!=="undefined")return(row-1)*11+col-1;return(row.s-1)*11+row.t-1}Core.W=function restart(){Music.X(char.floor,3e3);Core.A()};Core.Y=function loadGame(){Music.load();Doc.load()};var KEYBOARD_ENABLED=true;var keys={};var counter=0;function enableKeyboard(keydownFun){keydownFun=keydownFun||function(e){switch(e.which){case 9:case 18:case 27:for(var key in keys){clearInterval(keys[key]);delete keys[key]}return;case 37:clearInterval(keys[39]);delete keys[39];e.preventDefault();break;case 39:clearInterval(keys[37]);delete keys[37];e.preventDefault();break;case 38:clearInterval(keys[40]);delete keys[40];e.preventDefault();break;case 40:clearInterval(keys[38]);delete keys[38];e.preventDefault();break}if(!counter||!keys[e.which]){keyPressed(e.which)}if(counter==2)counter=-1;counter++;if(keys[e.which])return;keys[e.which]=setTimeout(function(){keys[e.which]=setInterval(keyPressed,100,e.which)},150)};$(document).on("keydown.interaction",keydownFun)}function disableKeyboard(){$(document).off("keydown.interaction");for(var key in keys){console.log("Stopping the interval of key: "+key);clearInterval(keys[key]);delete keys[key]}}$(document).on("keyup.interaction",function(e){clearInterval(keys[e.which]);delete keys[e.which]});$(window).load(function(){debugger;Core.Y();Core.A();if(!GOD)Messages.v()});function clearBoard(){for(var i=120;i>=0;i--){var rowcol=indexToRowCol(i);var tile=$("#rowcol-"+rowcol.s+"-"+rowcol.t);tile.removeClass().addClass("tile")}}var Items={};Items.Z=function(name){for(var item in specialItems){if(specialItems[item].U==name||prettyName(specialItems[item].U)==name)return specialItems[item]}return null};var floors=[[1,20,20,20,20,13,20,20,20,20,1,1,20,20,20,20,98,20,20,20,20,1,1,20,20,20,20,0,20,20,20,20,1,1,20,20,20,20,0,20,20,20,20,1,1,20,20,20,20,0,20,20,20,20,1,1,20,20,20,20,0,20,20,20,20,1,1,1,20,20,20,0,20,20,20,1,1,1,1,1,1,1,2,1,1,1,1,1,19,1,19,1,0,24,0,1,19,1,19,19,19,19,19,19,99,19,19,19,19,19,19,19,19,19,19,0,19,19,19,19,19],[13,98,6,40,41,40,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,11,0,44,2,0,1,11,6,11,1,0,6,44,10,1,0,1,11,6,11,1,0,1,2,1,1,0,1,1,1,43,1,0,6,45,0,1,0,2,63,40,42,1,0,9,0,7,1,0,1,1,1,1,1,0,1,2,1,1,0,0,0,0,0,0,0,0,45,0,1,1,4,1,1,1,2,1,11,12,6,1,8,97,0,1,6,46,7,11,34,6,1,0,14,0,1,6,6,6],[14,1,0,55,0,1,10,9,6,8,1,97,1,9,1,12,1,10,9,6,7,1,0,1,6,1,6,1,10,9,6,54,1,0,1,6,1,6,1,1,1,1,2,1,0,1,0,1,0,0,0,2,0,0,1,0,1,2,1,1,2,1,1,2,1,1,0,5,0,0,0,0,1,0,54,0,1,0,1,2,1,1,3,1,115,1,115,1,0,1,6,1,12,11,1,0,1,0,1,98,1,6,1,12,11,1,0,1,0,1,13,1,10,1,12,11,1,26,1,27,1],[71,41,6,1,23,22,21,1,1,1,1,41,6,0,1,0,0,0,1,0,42,0,6,44,0,1,1,2,1,1,0,1,0,1,2,1,1,0,44,0,1,6,1,41,0,0,0,1,1,1,0,1,6,1,42,40,1,0,42,41,42,0,1,6,1,41,40,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,1,1,2,1,1,0,1,1,1,1,42,1,41,0,41,1,0,1,0,0,0,0,1,9,42,6,1,98,14,97,1,1,1,1,10,12,6,1,13],[0,43,0,1,0,25,0,1,0,43,0,2,1,2,1,0,0,0,1,2,1,2,0,1,0,1,1,115,1,1,0,1,0,0,1,44,1,48,49,48,1,44,1,0,42,1,11,1,9,48,9,1,11,1,42,42,1,11,1,1,4,1,1,11,1,42,41,1,0,1,46,47,46,1,0,1,41,0,1,0,1,10,46,10,1,0,1,0,0,1,0,1,1,3,1,1,0,1,0,98,1,0,1,6,0,6,1,0,1,97,13,1,0,43,0,0,0,43,0,1,14],[36,1,11,1,12,63,0,0,63,6,7,0,1,10,1,63,0,0,0,0,63,6,48,1,0,1,45,0,1,1,2,1,1,0,2,63,1,76,45,1,0,46,45,27,48,1,0,1,1,1,1,0,0,0,45,10,1,0,0,0,42,44,0,0,0,0,9,1,1,43,1,1,1,1,0,0,0,0,26,1,43,1,0,0,0,46,47,0,1,1,1,42,1,2,1,3,1,2,1,97,0,1,0,1,42,1,9,2,98,1,14,0,42,0,0,0,1,6,1,13,1],[30,56,1,9,1,6,51,39,1,12,12,56,6,1,10,1,0,6,51,1,65,12,6,49,3,0,3,49,0,6,1,0,65,0,0,1,47,1,0,0,0,1,66,0,1,1,1,4,1,1,1,1,1,2,1,0,0,64,0,6,6,6,0,64,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,48,2,48,0,0,0,0,0,1,0,1,2,1,2,1,1,1,1,3,1,0,1,48,1,0,0,1,1,0,97,1,0,0,0,1,13,98,2,2,0,14,1],[13,98,0,0,0,0,0,0,1,1,1,1,1,0,49,1,3,1,56,0,1,1,1,0,49,9,1,50,1,10,56,0,1,0,0,1,1,1,15,1,1,1,0,0,0,0,3,50,115,32,15,50,3,0,0,0,1,1,1,1,15,1,1,1,1,0,0,1,11,10,1,50,1,9,11,1,0,0,1,6,11,1,3,1,11,6,1,0,0,1,1,7,7,12,7,7,1,1,0,0,0,1,1,1,4,1,1,1,0,0,1,0,0,2,14,97,0,2,0,0,1],[14,1,0,0,0,0,1,0,6,56,0,97,1,0,1,1,2,1,2,1,1,0,0,1,0,1,0,0,3,0,0,1,10,201,1,0,1,60,1,1,1,48,1,43,48,1,0,1,11,1,13,98,0,1,43,49,1,9,1,11,1,1,1,1,1,0,48,1,43,1,0,0,0,1,0,49,0,0,1,43,1,1,1,47,1,2,1,1,0,1,0,56,0,1,56,1,0,0,0,0,1,1,1,2,1,0,1,1,1,0,0,0,60,0,0,1,0,51,50,51,0],[35,6,0,1,1,1,0,0,0,1,0,6,0,66,2,0,0,0,1,0,2,56,1,2,1,1,0,1,1,1,0,1,6,0,0,0,1,0,1,97,0,0,1,6,0,0,0,4,0,1,14,1,0,1,11,1,3,1,1,0,1,1,1,0,1,1,9,52,10,1,60,1,13,1,0,1,11,1,2,1,1,0,0,98,2,0,1,6,56,11,56,1,1,3,1,1,0,1,6,7,56,11,1,65,60,65,1,0,2,56,72,7,56,2,12,65,12,1,0,1,0],[0,1,1,9,66,1,66,10,1,1,0,0,0,1,1,2,1,2,1,1,0,65,0,0,0,0,0,1,0,0,0,65,12,0,1,0,1,1,1,1,1,0,1,1,48,1,0,0,6,6,6,0,0,1,6,49,1,0,1,1,1,1,2,1,1,6,48,1,0,115,97,14,1,0,2,49,0,0,1,1,1,1,1,1,2,1,1,0,0,1,11,9,10,1,0,49,0,1,6,98,1,11,9,10,4,60,1,60,1,6,13,1,11,9,10,1,7,1,7,1,11],[11,1,6,1,7,1,8,1,12,77,12,11,1,6,1,7,1,8,1,47,47,47,11,1,6,1,7,1,8,1,0,47,0,2,1,2,1,2,1,2,1,1,3,1,0,0,0,0,0,1,0,0,0,0,0,2,1,1,3,1,1,1,3,1,1,2,9,1,0,68,12,67,12,68,0,1,10,9,1,66,1,1,1,1,1,66,1,10,9,1,66,1,23,22,21,1,66,1,10,1,1,4,1,11,0,11,1,4,1,1,14,97,0,0,0,0,0,0,0,98,13],[27,9,1,0,54,55,54,0,1,12,38,10,0,1,0,1,2,1,0,1,0,12,0,0,1,0,1,55,1,0,1,0,0,0,67,1,0,1,6,1,0,1,58,0,67,61,1,0,1,6,1,0,1,57,58,1,3,1,0,1,11,1,0,1,3,1,0,0,0,0,1,11,1,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,9,67,2,68,68,69,68,68,2,67,10,1,1,1,1,1,3,1,1,1,1,1,13,98,0,0,0,0,0,0,0,97,14],[0,67,0,0,0,0,0,1,0,61,0,0,1,1,1,1,1,2,1,0,1,0,0,1,0,0,68,0,0,1,0,1,0,12,1,4,1,1,1,0,1,0,1,0,54,1,0,0,61,1,68,1,10,1,0,55,1,0,62,15,1,69,1,10,1,0,54,1,61,115,26,1,68,1,10,1,9,0,1,1,1,1,1,0,1,0,1,9,0,54,0,1,0,0,0,61,0,1,9,1,1,0,1,12,1,1,1,1,1,0,14,97,0,3,98,13,1,31,62,2,0],[1,0,58,36,13,98,0,0,0,0,1,1,0,12,1,1,1,1,1,12,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,33,1,1,1,0,1,1,0,1,1,1,115,1,1,1,0,1,1,0,11,1,1,61,1,1,11,0,1,1,0,20,20,1,62,1,20,20,0,1,1,0,20,20,1,61,1,20,20,0,1,1,0,20,20,1,3,1,20,20,0,1,1,68,69,68,3,97,3,68,69,68,1,1,1,1,1,1,14,1,1,1,1,1],[0,0,0,97,14,20,13,98,0,0,0,0,20,20,20,20,20,20,20,20,20,0,0,20,20,1,1,1,1,1,20,20,0,0,20,1,1,26,1,27,1,1,20,0,0,20,1,1,9,1,9,1,1,20,0,0,20,1,1,10,1,10,1,1,20,0,0,20,20,1,0,1,0,1,20,20,0,0,20,20,1,2,1,2,1,20,20,0,0,20,20,20,0,0,0,20,20,20,0,0,20,20,20,20,4,20,20,20,20,0,0,0,0,0,0,0,0,0,0,0,0],[20,20,20,20,20,97,14,20,20,20,20,20,20,20,20,20,0,20,20,20,20,20,20,20,20,20,20,0,20,20,20,20,20,20,20,20,20,1,4,1,20,20,20,20,20,20,20,1,1,119,1,1,20,20,20,20,20,20,1,1,53,1,1,20,20,20,20,20,20,1,1,98,1,1,20,20,20,20,20,20,1,1,13,1,1,20,20,20,20,20,20,20,1,1,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],[20,58,62,0,0,0,0,0,0,0,58,20,62,20,20,20,20,20,20,20,20,0,20,0,20,58,0,0,0,0,0,0,58,20,0,20,0,20,20,20,20,20,20,20,20,0,20,0,20,58,0,0,0,58,20,20,0,20,58,0,0,20,20,20,0,20,20,0,20,20,20,20,20,58,0,58,20,20,62,20,20,20,14,20,0,20,20,20,20,58,62,0,70,97,20,58,0,0,58,20,20,20,20,20,20,20,20,20,20,0,13,98,70,0,0,0,0,0,0,0,58],[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,1,1,1,20,20,20,20,20,20,20,1,1,28,1,1,20,20,20,20,20,20,1,1,115,1,1,20,20,20,20,20,20,1,1,4,1,1,20,20,20,20,20,20,20,1,4,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,14,97,0,0,0,0,0,0,0,98,0],[0,0,0,0,0,0,0,0,0,0,0,0,20,0,20,20,20,20,20,0,20,0,0,20,0,20,20,20,20,20,0,20,0,0,20,0,20,20,13,20,20,0,20,0,0,20,0,20,20,98,20,20,0,20,0,0,20,53,20,20,0,20,20,53,20,0,0,20,115,20,20,59,20,20,115,20,0,0,20,75,20,20,129,20,20,80,20,0,0,20,20,20,20,0,20,20,20,20,0,0,20,20,20,20,0,20,20,20,20,0,0,0,0,0,0,0,0,0,0,97,14],[70,10,50,11,62,8,62,11,50,10,70,12,20,6,20,7,20,7,20,6,20,12,20,9,50,0,58,0,58,0,50,9,20,11,20,6,20,0,14,0,20,6,20,11,62,7,58,0,0,97,0,0,58,7,62,8,20,0,20,0,20,0,20,0,20,8,62,7,58,0,0,98,0,0,58,7,62,11,20,6,20,0,13,0,20,6,20,11,20,9,50,0,58,0,58,0,50,9,20,12,20,6,20,7,20,7,20,6,20,12,70,10,50,11,62,8,62,11,50,10,70],[20,20,20,20,20,20,20,20,20,20,20,20,20,0,0,20,59,20,0,0,20,20,20,0,0,20,20,57,20,20,0,0,20,20,0,0,0,20,57,20,0,0,0,20,20,20,0,0,0,0,0,0,0,20,20,20,20,0,0,0,97,0,0,0,20,20,20,20,20,0,0,20,0,0,20,20,20,20,20,20,20,15,14,15,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20]];var specialItems={0:{U:"road",action:function(){Music._("move")},aa:false},1:{U:"wall",action:function(){newChar=$.extend(true,{},char)},aa:false},2:{U:"door_yellow",action:function(){if(newChar.q>0){newChar.q--;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;return}newChar=$.extend(true,{},char);return},aa:false},3:{U:"door_blue",action:function(){if(newChar.blue>0){newChar.blue--;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;return}newChar=$.extend(true,{},char);return},aa:false},4:{U:"door_red",action:function(){if(newChar.red>0){newChar.red--;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;return}newChar=$.extend(true,{},char);return},aa:false},5:{U:"door_locked",action:function(){newChar=$.extend(true,{},char)},aa:false},6:{U:"key_yellow",action:function(){Music._("pick_up_key");newChar.q++;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("FOUND YELLOW KEY!")},aa:false},7:{U:"key_blue",action:function(){Music._("pick_up_key");newChar.blue++;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("FOUND BLUE KEY!")},aa:false},8:{U:"key_red",action:function(){Music._("pick_up_key");newChar.red++;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("FOUND RED KEY!")},aa:false},9:{U:"defense_gem",action:function(){Music._("pick_up_item");newChar.o+=3;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 3 DEFENSE!")},aa:false},10:{U:"attack_gem",action:function(){Music._("pick_up_item");newChar.attack+=3;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 3 ATTACK!")},aa:false},11:{U:"small_potion",action:function(){Music._("pick_up_item");newChar.m+=200;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 200 HEALTH!")},aa:false},12:{U:"big_potion",action:function(){Music._("pick_up_item");newChar.m+=500;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 500 HEALTH!")},aa:false},13:{U:"stair_up",action:function(){Music._("use_stairs");newChar.floor++;var newPos=indexToRowCol(newChar.u[newChar.floor].indexOf(97));newChar.s=newPos.s;newChar.t=newPos.t;KEYBOARD_ENABLED=false;setTimeout(function(){KEYBOARD_ENABLED=true},240)},aa:false},14:{U:"stair_down",action:function(){Music._("use_stairs");newChar.floor--;var newPos=indexToRowCol(newChar.u[newChar.floor].indexOf(98));newChar.s=newPos.s;newChar.t=newPos.t;KEYBOARD_ENABLED=false;setTimeout(function(){KEYBOARD_ENABLED=true},240)},aa:false},15:{U:"door_jail_fake",action:function(){newChar=$.extend(true,{},char)},aa:false,T:"door_jail"},19:{U:"lava",action:function(){newChar=$.extend(true,{},char)},aa:false},20:{U:"stars",action:function(){newChar=$.extend(true,{},char)},aa:false},21:{U:"shop_right",action:function(){newChar=$.extend(true,{},char)},aa:false},22:{U:"shop_head",action:function(){newChar=$.extend(true,{},char);disableKeyboard();if(newChar.v.O){notify("See your stats on the left",3e3);newChar.v.O=false}switch(newChar.floor){case 3:var main_text="Want to improve your abilities?\nFor only 25 cold coins, you can choose:";var opts=["800 point increase in life","4 point increase in attack","4 point increase in defense","Leave the store"];break;case 11:var main_text="Want to improve your abilities?\nFor only 100 cold coins, you can choose:";var opts=["4000 point increase in life","20 point increase in attack","20 point increase in defense","Leave the store"];break;default:console.log("newChar.floor insn't 3 nor 11. newChar.floor is "+newChar.floor);var main_text="This is an error";var opts=[];break}shop(main_text,opts);var $shop=$("#shop-container .flex-container");$shop.find(".flex_item-"+specialItems[22].selected).toggleClass("selected");if(specialItems[34].ba)keyAction[76]();if(specialItems[35].ca)keyAction[79]();enableKeyboard(function(e){e.preventDefault();var key=Number(e.which);console.log("The key "+key+" was pressed.");var $shop=$("#shop-container .flex-container");var obj=specialItems[22];var selected=obj.selected;var coins_needed;var life_earned;var attack_earned;var defense_earned;switch(newChar.floor){case 3:coins_needed=25;life_earned=800;attack_earned=4;defense_earned=4;break;case 11:coins_needed=100;life_earned=4e3;attack_earned=20;defense_earned=20;break;default:console.log("newChar.floor insn't 3 nor 11. newChar.floor is "+newChar.floor);main_text="This is an error";break}$shop.find(".flex_item-"+selected).removeClass("selected");switch(Core.P(key)){case"left":case"up":if(selected>1){selected--;Music._("move_shop")}break;case"right":case"down":if(selected<opts.length){selected++;Music._("move_shop")}break;case"enter":if(selected<4&&newChar.B>=coins_needed){newChar.B-=coins_needed;if(selected==1)newChar.m+=life_earned;if(selected==2)newChar.attack+=attack_earned;if(selected==3)newChar.o+=defense_earned;updateChar();break}if(selected<4&&newChar.B<coins_needed)break;selected=1;case"esc":Music._("exit_shop");$shop.parent().hide();disableKeyboard();enableKeyboard();break;case"mobScreen":if(keyAction[key])keyAction[key]();break}obj.selected=selected;$shop.find(".flex_item-"+selected).toggleClass("selected")})},aa:false,selected:1},23:{U:"shop_left",action:function(){newChar=$.extend(true,{},char)},aa:false},24:{U:"fairy",action:function(){newChar=$.extend(true,{},char);if(newChar.data.F==1){var afterFun=function(){newChar.q++;newChar.blue++;newChar.red++;Music._("end_fairy_dialog");newChar.u[newChar.floor][93]=0;setTile(9,6,0);newChar.u[newChar.floor][92]=24;setTile(9,5,24);newChar.data.F++;updateChar();notify("EARNED ONE KEY OF EACH TYPE!")};dialog("fairy_1",afterFun)}else if(newChar.data.F==2&&newChar.data.da){var afterFun=function(){newChar.m=Math.round(newChar.m*4/3);newChar.attack=Math.round(newChar.attack*4/3);newChar.o=Math.round(newChar.o*4/3);newChar.data.F++;updateChar();notify("YOU ARE MUCH STRONGER!!",1400)};dialog("fairy_2",afterFun)}},aa:false},25:{U:"thief",action:function(){newChar=$.extend(true,{},char);if(newChar.data.dialogs.thief_1){var afterFun=function(){newChar.data.dialogs.thief_1=false;newChar.u[2][67]=0;updateChar()};dialog("thief_1",afterFun)}else if(newChar.data.dialogs.thief_2&&newChar.data.K.L){newChar.data.K.L=false;newChar.data.dialogs.thief_2=false;updateChar();var afterFun=function(){newChar.u[4][5]=0;setTile(1,6,0);newChar.u[18][rowcolToIndex(9,6)]=0;newChar.u[18][rowcolToIndex(10,6)]=0;updateChar()};dialog("thief_2",afterFun)}},aa:false},26:{U:"old_man",action:function(){newChar=$.extend(true,{},char);if(newChar.floor==5||newChar.floor==13){disableKeyboard();switch(newChar.floor){case 5:var main_text="Hello, hero of humanity. As long as you have enough experience, I can make you more powerful:";var opts=["Level Up (100 points)","Increase 5 attack (30 points)","Increase 5 defense (30 points)","Leave the store"];break;case 13:var main_text="Hello, savior of humanity, as long as you have enough experience, I can make you stronger:";var opts=["Enhance yourself (270 points)","Increase 17 attack (95 points)","Increase 17 defense (95 points)","Leave the store"];break;default:console.log("newChar.floor insn't 5 nor 13. newChar.floor is "+newChar.floor);var main_text="This is an error";var opts=[];break}shop(main_text,opts);var $shop=$("#shop-container .flex-container");$shop.find(".flex_item-"+specialItems[22].selected).toggleClass("selected");if(specialItems[34].ba)keyAction[76]();if(specialItems[35].ca)keyAction[79]();enableKeyboard(function(e){e.preventDefault();var key=Number(e.which);console.log("The key "+key+" was pressed.");var $shop=$("#shop-container .flex-container");var obj=specialItems[22];var selected=obj.selected;var experience_needed_stat_increase;var experience_needed_level_up;var attack_earned_normal;var defense_earned_normal;var levels_earned;switch(newChar.floor){case 5:experience_needed_stat_increase=30;experience_needed_level_up=100;attack_earned_normal=5;defense_earned_normal=5;levels_earned=1;break;case 13:experience_needed_stat_increase=95;experience_needed_level_up=270;attack_earned_normal=17;defense_earned_normal=17;levels_earned=3;break;default:console.log("newChar.floor insn't 3 nor 11. newChar.floor is "+newChar.floor);main_text="This is an error";break}$shop.find(".flex_item-"+selected).removeClass("selected");switch(Core.P(key)){case"left":case"up":if(selected>=2){selected--;Music._("move_shop")}break;case"right":case"down":if(selected<opts.length){selected++;Music._("move_shop")}break;case"enter":if(selected==1){if(newChar.p<experience_needed_level_up)break;newChar.p-=experience_needed_level_up;Core.V(levels_earned);break}if(selected<4){if(newChar.p<experience_needed_stat_increase)break;newChar.p-=experience_needed_stat_increase;if(selected==2)newChar.attack+=attack_earned_normal;if(selected==3)newChar.o+=defense_earned_normal;updateChar();break}else{Music._("exit_shop");$shop.parent().hide();selected=1;disableKeyboard();enableKeyboard();break}case"esc":Music._("exit_shop");$shop.parent().hide();disableKeyboard();enableKeyboard();break;case"mobScreen":if(keyAction[key])keyAction[key]();break}obj.selected=selected;$shop.find(".flex_item-"+selected).toggleClass("selected")})}else{if(newChar.floor==2&&newChar.data.dialogs.old_man_1)dialog("old_man_1",function(){newChar.attack+=70;notify("Earned 70 attack!",1e3);newChar.data.dialogs.old_man_1=false;updateChar()});else if(newChar.floor==15&&newChar.data.dialogs.old_man_2)dialog("old_man_2",function(){sendMessage(' \t\t\t\t\t\t<div style="height: calc(100% + 120px);width: 100%;display:flex;flex-direction:column;margin: auto;align-items: center;"> \t\t\t\t\t\t\t<p id="main_text" style=" display: block; position: relative;">Spend 500 experience points?</p> \t\t\t\t\t\t\t<div style=" display: flex; width: 100%;"> \t\t\t\t\t\t\t\t<div id="option_1" style="display: flex; position: relative; float: left; width: 50%;" class="selected"> <h1 style="margin:auto;">Yeah</h1> </div>\t\t\t\t\t\t\t\t\t<div id="option_2" style="display: flex; position: relative; float: right; width: 50%;" > <h1 style="margin:auto;">Maybe later</h1> </div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div>',function(e){
$("#option_1").removeClass("selected");$("#option_2").removeClass("selected");var option=newChar.data.ea||1;switch(Core.P(e.which)){case"left":if(option>1){option--;Music._("move_shop")}break;case"right":if(option<2){option++;Music._("move_shop")}break;case"enter":if(option==2){clearMessage()}if(option==1){if(newChar.p>=500){newChar.attack+=120;newChar.p-=500;clearMessage();notify("GAINED 120 ATTACK!");newChar.data.dialogs.old_man_2=false}else{clearMessage();notify("NOT ENOUGH EXPERIENCE")}}option=1;break;case"esc":clearMessage();break}$("#option_"+option).addClass("selected");newChar.data.ea=option;updateChar()})})}},aa:false,selected:1},27:{U:"merchant",action:function(){newChar=$.extend(true,{},char);if(newChar.floor==5||newChar.floor==12){disableKeyboard();switch(newChar.floor){case 5:var main_text="I’m sure you have other needs as well.\nAs long as you have money, I can help you:";var opts=["Buy a yellow key ($ 10)","Buy a blue key ($ 50)","Buy a red key ($ 100)","Leave the store"];break;case 12:var main_text="If you are short of gold, I may be of help:";var opts=["Sell a yellow key ($ 7)","Sell a blue key ($ 35)","Sell a red key ($ 70)","Leave the store"];break;default:console.log("newChar.floor insn't 5 nor 13. newChar.floor is "+newChar.floor);var main_text="This is an error";var opts=[];break}shop(main_text,opts);var $shop=$("#shop-container .flex-container");$shop.find(".flex_item-"+specialItems[22].selected).toggleClass("selected");if(specialItems[34].ba)keyAction[76]();if(specialItems[35].ca)keyAction[79]();enableKeyboard(function(e){e.preventDefault();var key=Number(e.which);console.log("The key "+key+" was pressed.");var $shop=$("#shop-container .flex-container");var obj=specialItems[22];var selected=obj.selected;var yellow_key_price;var blue_key_price;var red_key_price;switch(newChar.floor){case 5:yellow_key_price=10;blue_key_price=50;red_key_price=100;break;case 12:yellow_key_price=7;blue_key_price=35;red_key_price=70;break;default:console.log("newChar.floor insn't 3 nor 12. newChar.floor is "+newChar.floor);break}$shop.find(".flex_item-"+selected).removeClass("selected");switch(Core.P(key)){case"left":case"up":if(selected>=2){selected--;Music._("move_shop")}break;case"right":case"down":if(selected<opts.length){selected++;Music._("move_shop")}break;case"enter":if(selected<4){if(newChar.floor==5){if(selected==1&&newChar.B>yellow_key_price){newChar.B-=yellow_key_price;newChar.q++}if(selected==2&&newChar.B>blue_key_price){newChar.B-=blue_key_price;newChar.blue++}if(selected==3&&newChar.B>red_key_price){newChar.B-=red_key_price;newChar.red++}}if(newChar.floor==12){if(selected==1&&newChar.q>0){newChar.B+=yellow_key_price;newChar.q--}if(selected==2&&newChar.blue>0){newChar.B+=blue_key_price;newChar.blue--}if(selected==3&&newChar.red>0){newChar.B+=red_key_price;newChar.red--}}updateChar();break}else{Music._("exit_shop");$shop.parent().hide();selected=1;disableKeyboard();enableKeyboard();break}case"esc":Music._("exit_shop");$shop.parent().hide();disableKeyboard();enableKeyboard();break;case"mobScreen":if(keyAction[key])keyAction[key]();break}obj.selected=selected;$shop.find(".flex_item-"+selected).toggleClass("selected")})}else{if(newChar.floor==2&&newChar.data.dialogs.merchant_1)dialog("merchant_1",function(){Core.V(newChar);notify("Level Up!",1e3);newChar.m+=1e3;newChar.o+=85;setTimeout(function(){notify("Earned 85 defense and 1000 HP!",1e3)},1050);newChar.data.dialogs.merchant_1=false;updateChar()});else if(newChar.floor==15&&newChar.data.dialogs.merchant_2)dialog("merchant_2",function(){sendMessage(' \t\t\t\t\t\t<div style="height: calc(100% + 120px);width:100%;display:flex;flex-direction:column;margin: auto;align-items: center;"> \t\t\t\t\t\t\t<p id="main_text" style="display:block;position:relative;">Spend 800 gold coins?</p> \t\t\t\t\t\t\t<div style="display: flex; width: 100%;"> \t\t\t\t\t\t\t\t<div id="option_1" style="display:flex;position:relative;float:left;width:50%;" class="selected"> <h1 style="margin:auto;">Yeah</h1> </div>\t\t\t\t\t\t\t\t\t<div id="option_2" style="display:flex;position:relative;float:right;width:50%;" > <h1 style="margin:auto;">Maybe later</h1> </div> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t</div>',function(e){$("#option_1").removeClass("selected");$("#option_2").removeClass("selected");var option=newChar.data.ea||1;switch(Core.P(e.which)){case"left":if(option>1){option--;Music._("move_shop")}break;case"right":if(option<2){option++;Music._("move_shop")}break;case"enter":if(option==1){if(newChar.B>=800){clearMessage();Core.V(newChar);notify("LEVEL UP",1e3);newChar.m+=1e3;newChar.attack+=85;setTimeout(function(){notify("GAINED 85 ATTACK AND 1000 HP!",1e3)},1e3);newChar.B-=800;newChar.data.dialogs.merchant_2=false}else{clearMessage();notify("NOT ENOUGH COINS")}}if(option==2){clearMessage()}option=1;break}$("#option_"+option).addClass("selected");newChar.data.ea=option;updateChar()})})}},aa:false},28:{U:"princess",action:function(){newChar=$.extend(true,{},char);if(newChar.data.dialogs.princess)dialog("princess",function(){newChar.data.dialogs.princess=false;newChar.u[18][120]=13;setTile(11,11,13);updateChar()})},aa:false},30:{U:"super_wing_1",action:function(){Core.V(newChar);newChar.m+=200;newChar.attack+=4;newChar.o+=4;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("EARNED STATS AND LEVEL!",1e3)},aa:false},31:{U:"super_wing_2",action:function(){Core.V(newChar);newChar.m+=600;newChar.attack+=12;newChar.o+=12;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("EARNED STATS AND LEVELS!",1e3)},aa:false},32:{U:"lucky_cross",action:function(){newChar.data.da=true;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;sendMessage('<div style="display: block;"> \t\t\t\t <div style="color:sandybrown"><center><h1>Lucky Cross</h1></center></div> \t\t\t\t <h5><br>Give it to the fairy to enhance her abilities</h5>'+fadeTextElement('<h6 style="bottom: 0px; float:right;">Space</h6>')+"</div>");newChar.s=char.s;newChar.t=char.t;updateChar()},aa:false},33:{U:"holy_water",action:function(){newChar.data.fa=true;sendMessage('<div style="display: block;"> \t\t\t\t <div style="color:sandybrown"><center><h1>Holy Water</h1></center></div> \t\t\t\t <h5><br>Drinking the holy water doubles your constitution </h5> \t\t\t\t <br><h5>To use it, press the <span style="color:#18D800">U</span> \t\t\t\t in your keyboard.</h5>'+fadeTextElement('<h6 style="bottom: 0px; float:right;">Space</h6>')+"</div>");keyAction[85]=function(){if(newChar.data.fa){newChar.data.fa=false;newChar.m*=2;notify("DOUBLED YOUR CONSTITUTION",1e3);updateChar()}};setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;updateChar()},aa:false},34:{U:"light_emblem",action:function(){sendMessage('<div style="display: block;"> \t\t\t\t <div style="color:khaki"><center><h1>Light Emblem</h1></center></div> \t\t\t\t <h5><br>This treasure can see the basic situation \t\t\t\t of monsters.<br>To use it, press the <span style="color:#18D800">L</span> \t\t\t\t in your keyboard.</h5>'+fadeTextElement('<h6 style="bottom: 0px; float:right;">Space</h6>')+"</div>");keyAction[76]=function(){KEYBOARD_ENABLED=false;setTimeout(function(){KEYBOARD_ENABLED=true},160);$mobScreen=$("#mob-screen");if(specialItems[34].ba){$mobScreen.hide();specialItems[34].ba=false}else{$mobScreen.show();specialItems[34].ba=true;var floor=newChar.u[newChar.floor];var enemies=[];for(var i=0;i<floor.length;i++){if(specialItems[floor[i]]===undefined)continue;var isMob;if(typeof specialItems[floor[i]].aa==="function")isMob=specialItems[floor[i]].aa();else isMob=specialItems[floor[i]].aa;if(isMob)if(enemies.indexOf(specialItems[floor[i]])==-1)enemies.push(specialItems[floor[i]])}enemies.sort(function(a,b){if(a.U>b.U)return 1;if(a.U<b.U)return-1;return 0});$('#mob-screen [id^="row-"]').hide();for(var i=0;i<enemies.length;i++){var name=enemies[i].U;var mob=enemies[i].ga;var arr=name.split("_");var disName="";for(n=0;n<arr.length;n++){disName=disName+" "+arr[n][0].toUpperCase()+arr[n].substring(1)}disName=disName.substring(1);var $row=$("#mob-screen #row-"+(i+1)).show();$row.find("#name").text(disName);$row.find("#body").attr("src","./res/image/"+name+".gif");$row.find("#life").text(mob.m);$row.find("#attack").text(mob.attack);$row.find("#defense").text(mob.o);$row.find("#gains").text(mob.B+"~"+mob.p);var loss=0;var damChar=newChar.attack-mob.o;if(damChar<=0)loss="∞";else loss=(Math.ceil(mob.m/damChar)-1)*(mob.attack-newChar.o);if(loss!="∞"&&loss<1)loss=0;$row.find("#loss").text(loss)}}Doc.style()};setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t},aa:false,ba:false},35:{U:"wind_compass",action:function(){sendMessage('<div style="display: block;"> \t\t\t\t <div style="color:lightsteelblue"><center><h1>Wind Compass</h1></center></div> \t\t\t\t <h5><br>This treasure lets you go freely up or down \t\t\t\t floors that you’ve visited previously.<br> Use the \t\t\t\t <span style="color:#18D800">O</span> \t\t\t\t and select the floor you want to send a \t\t\t\t stream of wind that will carry you there.</h5>'+fadeTextElement('<h6 style="bottom: 0px; float:right;">Space</h6>')+"</div>");keyAction[79]=function(){var $floorScreen=$("#floor-screen");var $flex=$floorScreen.find(".flex-container");if(specialItems[35].ca){$floorScreen.hide();disableKeyboard();enableKeyboard();specialItems[35].ca=false}else{if(newChar.floor==floors.length-1)return;specialItems[35].ca=true;$floorScreen.show();disableKeyboard();$flex.empty();for(var i=1;i<=newChar.data.D;i++){var floorDiv='<div class="flex_item-'+i+'"><h5 id="floor-'+i+'">Floor '+i+"</h5></div>";$flex.append(floorDiv)}$flex.find("#floor-"+specialItems[35].selected).toggleClass("selected");enableKeyboard(function(e){e.preventDefault();var key=Number(e.which);var selected=specialItems[35].selected;var floorReached=newChar.data.D;$flex.find("#floor-"+selected).removeClass("selected");switch(Core.P(key)){case"left":if(selected>7)selected-=7;break;case"right":if(selected<=floorReached-7)selected+=7;break;case"up":if(selected>=2)selected--;break;case"down":if(selected<floorReached)selected++;break;case"enter":if(newChar.floor<selected){var newPos=indexToRowCol(newChar.u[selected].indexOf(97));newChar.s=newPos.s;newChar.t=newPos.t}if(newChar.floor>selected){var newPos=indexToRowCol(newChar.u[selected].indexOf(98));newChar.s=newPos.s;newChar.t=newPos.t}newChar.floor=selected;Music._("wind_compass");case"esc":if(specialItems[34].ba)keyAction[76]();keyAction[79]();updateChar();break;default:if(keyAction[key])keyAction[key]();break}specialItems[35].selected=selected;$flex.find("#floor-"+selected).toggleClass("selected")})}};setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t},ca:false,selected:1},36:{U:"key_super",action:function(){newChar.q++;newChar.blue++;newChar.red++;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("EARNED KEYS!",600)},aa:false},38:{U:"star_pickaxe",action:function(){newChar.data.K.L=true;sendMessage('<div style="display: block;"> \t\t\t\t <div style="color:sandybrown"><center><h1>Starlight God Ornament</h1></center></div> \t\t\t\t <h5><br>An experienced locksmith can open the gate to the Dark Clouds using the Starlight.</h5>'+fadeTextElement('<h6 style="bottom: 0px; float:right;">Space</h6>')+"</div>");setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;updateChar()},aa:false},39:{U:"king_coin",action:function(){newChar.B+=300;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("KING COIN! EARNED 300 GOLD!",1e3)},aa:false},40:{U:"green_slime",action:function(){fight(40)},ga:{m:50,attack:20,o:1,B:1,p:1},aa:true},41:{U:"red_slime",action:function(){fight(41)},ga:{m:70,attack:15,o:2,B:3,p:2},aa:true},42:{U:"bat",action:function(){fight(42)},ga:{m:100,attack:20,o:5,B:3,p:2},aa:true},43:{U:"dark_mass",action:function(){fight(43)},ga:{m:200,attack:35,o:10,B:5,p:3},aa:true},44:{U:"skeleton",action:function(){fight(44)},ga:{m:110,attack:25,o:5,B:5,p:3},aa:true},45:{U:"armed_skeleton",action:function(){fight(45)},ga:{m:150,attack:40,o:20,B:8,p:5},aa:true},46:{U:"sand_guardian",action:function(){fight(46)},ga:{m:300,attack:75,o:45,B:13,p:10},aa:true},47:{U:"sand_god",action:function(){fight(47)},ga:{m:450,attack:150,o:90,B:22,p:19},aa:true},48:{U:"large_bat",action:function(){fight(48)},ga:{m:150,attack:65,o:30,B:10,p:8},aa:true},49:{U:"vampire",action:function(){fight(49)},ga:{m:550,attack:170,o:100,B:25,p:20},aa:true},50:{U:"white_knight",action:function(){fight(50)},ga:{m:1300,attack:400,o:225,B:40,p:30},aa:true},51:{U:"mysterious_king",action:function(){fight(51)},ga:{m:700,attack:250,o:125,B:32,p:25},aa:true},52:{U:"wizard",action:function(){fight(52)},ga:{m:500,attack:400,o:260,B:47,p:35},aa:true},53:{U:"devil",action:function(){switch(newChar.floor){case 16:this.ga={m:15e3,attack:1e3,o:1e3,B:100,p:100};break;case 19:this.ga={m:2e4,attack:1333,o:1333,B:100,p:100};break}fight(53)},ga:{m:15e3,attack:1e3,o:1e3,B:100,p:100},aa:true},54:{U:"officer",action:function(){fight(54)},ga:{m:1e3,attack:500,o:380,B:45,p:35},aa:function mob(){if(newChar.floor==2)return false;return true}},55:{U:"major",action:function(){fight(55)},ga:{m:900,attack:750,o:650,B:77,p:60},aa:function mob(){if(newChar.floor==2)return false;return true}},56:{U:"skeleton_captain",action:function(){fight(56)},ga:{m:400,attack:90,o:50,B:15,p:12},aa:true},57:{U:"dark_king",action:function(){fight(57)},ga:{m:1500,attack:830,o:730,B:80,p:65},aa:true},58:{U:"dark_knight",action:function(){fight(58)},ga:{m:1200,attack:980,o:900,B:88,p:75},aa:true},59:{U:"chaos",action:function(){if(newChar.floor==19)fight(59,function(){var mob=specialItems[59].ga;mob.m=37500;mob.attack=2250;mob.o=1800;newChar.data.M.N=true;updateChar();dialog("chaos_1_after")});if(newChar.floor==21){fight(59,function(){dialog("chaos_2_after")})}},ga:{m:25e3,attack:1500,o:1200,B:150,p:120},aa:true},60:{U:"mage",action:function(){fight(60)},ga:{m:150,attack:120,o:70,B:20,p:5},aa:true},61:{U:"knight",action:function(){fight(61)},ga:{m:2e3,attack:680,o:590,B:70,p:55},aa:true},62:{U:"osiris",action:function(){fight(62)},ga:{m:2500,attack:900,o:850,B:84,p:70},aa:true},63:{U:"sorcerer",action:function(){fight(63)},ga:{m:125,attack:50,o:25,B:10,p:7},aa:true},64:{U:"necromancer",action:function(){fight(64)},ga:{m:100,attack:200,o:110,B:30,p:25},aa:true},65:{U:"moai",action:function(){fight(65)},ga:{m:500,attack:115,o:65,B:15,p:15},aa:true},66:{U:"sand_warrior",action:function(){fight(66)},ga:{m:900,attack:450,o:330,B:50,p:40},aa:true},67:{U:"zoro",action:function(){fight(67)},ga:{m:1200,attack:620,o:520,B:65,p:50},aa:true},68:{U:"apep",action:function(){fight(68)},ga:{m:1250,attack:500,o:400,B:55,p:45},aa:true},69:{U:"sutekh",action:function(){fight(69)},ga:{m:1500,attack:560,o:460,B:60,p:50},aa:true},70:{U:"teslathor",action:function(){fight(70)},ga:{m:3100,attack:1050,o:950,B:92,p:80},aa:true},71:{U:"sword_1",action:function(){newChar.attack+=10;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 10 ATTACK!")},aa:false},72:{U:"sword_2",action:function(){newChar.attack+=40;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 40 ATTACK!")},aa:false},75:{U:"sword_5",action:function(){newChar.attack+=120;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t},aa:false},76:{U:"shield_1",action:function(){newChar.o+=15;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 15 DEFENSE!")},aa:false},77:{U:"shield_2",action:function(){newChar.o+=50;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 50 DEFENSE!")},aa:false},80:{U:"shield_5",action:function(){newChar.o+=150;setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;notify("GAINED 150 DEFENSE!")},aa:false},97:{U:"move_up_target",action:function(){Items.Z("road").action()},aa:false,T:"road"},98:{U:"move_down_target",action:function(){Items.Z("road").action()},aa:false,T:"road"},115:{U:"door_jail_real",action:function(){setTile(newChar.s,newChar.t,0);newChar.u[newChar.floor][rowcolToIndex(newChar.s,newChar.t)]=0;newChar.s=char.s;newChar.t=char.t;return},aa:false,T:"door_jail"},119:{U:"devil_dialog_start",action:function(){newChar=$.extend({},char,true);dialog("red_devil",function(){newChar.u[16][rowcolToIndex(5,6)]=0;updateChar()});return},aa:false,T:"road"},129:{U:"chaos_dialog_start",action:function(){newChar=$.extend(true,{},char);dialog("chaos_1",function(){newChar.u[19][rowcolToIndex(8,6)]=0;updateChar()});return},aa:false,T:"road"},201:{U:"sign",action:function(){Messages.beta();newChar=$.extend(true,{},char);return},aa:false}};var specialItemsBackUp=tree.clone(specialItems,true);var Fight=function Fight(){var Fight=function Fight(){alert("Called the Fight contructor, what has no sense.")};Fight.ha=function(){};return Fight}();function fight(mobNumber,afterFun){afterFun=afterFun||function(){};Fight.ha=afterFun;var name=specialItems[mobNumber].U;var mob=specialItems[mobNumber].ga;var life=mob.m;var attack=mob.attack;var defense=mob.o;var damChar=newChar.attack-defense;if(damChar<=0){Music._("too_weak");newChar=$.extend(true,{},char);return false}var turns=Math.ceil(life/damChar)-1;var damMob=attack-newChar.o;if(turns*damMob>newChar.m){Music._("too_weak");newChar=$.extend(true,{},char);return false}KEYBOARD_ENABLED=false;$("#mob #name").text(prettyName(name));$("#mob #body").attr("src","./res/image/"+name+".gif");$("#mob #life").text(life);$("#mob #attack").text(attack);$("#mob #defense").text(defense);$("#warrior #life").text(newChar.m);$("#warrior #attack").text(newChar.attack);$("#warrior #defense").text(newChar.o);$("#display-fight").css("display","block");Doc.style();setTimeout(attackChar,40,life,attack,defense,mob);var damChar=newChar.attack-mob.o;var turns=Math.floor(mob.m/damChar);oldChar=$.extend(true,{},newChar);newChar.s=char.s;newChar.t=char.t;updateChar();return true}function attackChar(life,attack,defense,mob){var fightSpeed=newChar.data.G.J;var damChar=newChar.attack-defense;life-=damChar;if(life<1)life=0;$("#mob #life").text(life);if(life>0)setTimeout(attackMob,fightSpeed,life,attack,defense,mob);else{setTimeout(function(mob){Music._("end_fight");setTile(oldChar.s,oldChar.t,0);newChar.u[oldChar.floor][rowcolToIndex(oldChar.s,oldChar.t)]=0;newChar.B=oldChar.B+mob.B;newChar.p=oldChar.p+mob.p;KEYBOARD_ENABLED=true;notify("GAINED "+mob.B+" "+(mob.B>1?"COINS":"COIN")+" AND "+mob.p+" EXP!",700);updateChar();$("#display-fight").hide();Fight.ha()},fightSpeed*2,mob)}}function attackMob(life,attack,defense,mob){var fightSpeed=newChar.data.G.J;var damMob=attack-newChar.o;if(damMob<0)damMob=0;newChar.m-=damMob;$("#warrior #life").text(newChar.m);setTimeout(attackChar,fightSpeed,life,attack,defense,mob)}var dialog_chat_message_number;var dialog_chat;var dialog_after_function;function dialog(name,afterFun){var dia=dialogs[name];var $item=$("#dialog_item");var $war=$("#dialog_warrior");$item.find("#icon").attr("src","./res/image/"+dia.icon+".gif");$item.find("#title").text(dia.title+":");dialog_chat=dia.ia;dialog_chat_message_number=0;dialog_after_function=afterFun===undefined?function(){}:afterFun;disableKeyboard();enableKeyboard(function(e){var key=Number(e.which);if(Core.P(key)!="enter")return;var i=dialog_chat_message_number;if(i>=dialog_chat.length){$war.hide();$item.hide();disableKeyboard();enableKeyboard();dialog_after_function();return}if(i>0)Music._("dialog");var mess=dialog_chat[i];if(mess[0]==0){mess[1]=$war.find("#message").text(mess[1]).text();$war.find("#message").html(mess[1].replace(/\n/g,"<br>"));$item.hide();$war.show()}else{mess[1]=$item.find("#message").text(mess[1]).text();$item.find("#message").html(mess[1].replace(/\n/g,"<br>"));$war.hide();$item.show()}dialog_chat_message_number++});simulateKeydown(32)}var dialogs={fairy_1:{icon:"fairy",title:"Fairy",ia:[[0,"......"],[1,"You are awake!"],[0,"Who are you? Where am I?"],[1,"I am a fairy, I was here when mobs knocked you out."],[0,"Did you see my sword?"],[1,"Your sword was taken away, I only had time to rescue you."],[0,"Is the princess alright? I'm here to rescue her."],[1,"The princess is inside, but you are no match for the monsters in there."],[0,"What can I do? I promised the king that I was going to save her."],[1,"Do not worry. I will lend you all of my power to help you beat those mobs that have beaten me before."],[1,"However, you have to help me find something first."],[0,"Find something? What do you want to find?"],[1,"A cross with a red gem in the middle."],[0,"What's that thing for?"],[1,"I had this guardian tower not long ago, and an evil group of monsters from the north with magic took it from me and sealed my magic in this cross. "],[1,"If you can bring it out of the tower, the magic in the seal will gradually come back to me, then, I will be able to lend you strength to rescue the princess."],[0,"Well... I will try."],[1,"I just went there to look for your stuff. Your sword is on the third floor, and your shield on the fifth."],[1,"Oh, and that cross I just mentioned is on the seventh floor, but to go to the seventh floor you must first retrieve your sword and shield."],[1,"In addition, the other floors in the tower have had for centuries swords and treasures, which, if you recover, they’ll help you a lot in dealing with the monsters inside."],[0,"But... How do I get in?"],[1,"I've got three keys, take them. There aren't a lot of them in the tower."],[1,"Go, brave warrior!!!"]]},fairy_2:{icon:"fairy",title:"Fairy",ia:[[0,"Fairy, I’ve found the cross with the gem."],[1,"You did very well. Now I can give you more power!"],[1,"Mew La Quiver Mew Clamor... "],[1,"There, I’ve enhanced your ability!"]]},old_man_1:{icon:"old_man",title:"Old Man",ia:[[0,"You are safe now!"],[1,"Oh, my son. Thank you so much!"],[1,"This place is so dirty and scary. I can't stand it anymore!"],[0,"Just go now. I still need to rescue the princess."],[1,"Oh, you're here to rescue our princess. To express my appreciation        please allow me to give this to you. I used it when I was still young."],[1,"Use it to save the princess!!"]]},old_man_2:{icon:"old_man",title:"Old Man",ia:[[1,"Hello, brave child, you are finally here."],[1,"I'll give you a very good treasure."],[1,"It will increase your attack by a 120 points. But it will cost you        500 experience points."],[1,"Just think about it."]]},merchant_1:{icon:"merchant",title:"Businessman",ia:[[0,"You are safe now!"],[1,"Oh, thanks! I really appreciate it!"],[1,"I'm a business man. I don't know why I was brought here."],[0,"Go on, you are free now!"],[1,"Oh, yeah, I'm free now!"],[1,"I'll give this to you, then. I was going to sell this before but you can keep it."],[1,"I hope it helps!"]]},merchant_2:{icon:"merchant",title:"Businessman",ia:[[1,"Aha, welcome! I have an item that will be good for you."],[1,"As long as you have the money, I'll sell it to you."],[0,"What kind of thing? How much?"],[1,"It is the best shield in this world. It will increase 120 your defense."],[1,"It only costs you 800 gold coins."]]},thief_1:{icon:"thief",title:"Thief",ia:[[0,"You are saved!"],[1,"Ah, that is great! I can hunt treasures again!"],[1,"Oh, I haven't introduced myself. I'm Jack."],[1,"I'm a famous thief around here. I stole many treasures before."],[1,"But I had bad luck this time. I was caught just after I got in here."],[1,"Since you opened this door for me, let me help you out."],[0,"Just go now. There're many monsters outside. I may not be able to take care of you."],[1,"No, It doesn't matter.\nJust tell me what do you want me to do."],[0,"....Can you open a door?"],[1,"Of course."],[0,"Then please open the door of the 2nd floor for me!"],[1,"That's easy."],[1,"If you happen to find a pickaxe studded with a ruby..."],[1,"… come talk to me.\nSomething weird is going on here."],[0,"A pickaxe studded with a ruby? Ok, I'll try to help you."],[1,"Thank you very much.\nI'll open the door on 2nd floor right now."],[1,"If you find that pickaxe, come here again and talk to me."]]},thief_2:{icon:"thief",title:"Thief",ia:[[0,"Hey, look what I found!"],[1,"Wow! So the tales were true! That thing was really here!"],[1,"The tale says that if a thief breaks the roof of this tower,  a very important person can conjure a gate to the real top of the tower."],[1,'They say it is a cursed land, called by most as "Dark Clouds".'],[0,"I need to go go there to save the kingdom!"],[1,"As a thief, I can do this, but it is very dangerous. I'm only going to do it because you saved me. "],[1,"Tell my family I love them."],[1,"After the roof breaks you will need to find a way to open the portal, meanwhile, I will use the debris to make a bridge to reach the princess, and stairs for the portal."]]},princess:{icon:"princess",title:"Princess",ia:[[0,"Princess! You are safe now!"],[1,"Oh, are you here to save me?"],[0,"Yes, I am instructed by the king's command to save you."],[0,"Please follow me out of here!"],[1,"No, I don't want to leave yet."],[0,"Why? There are demons everywhere in here."],[1,"That’s exactly why I can’t just leave."],[1,"I want to see this demon killed myself!"],[1,"Heroic warrior, if you can kill the Demon..."],[1,"I'll go with you"],[0,"The Demon?\nI've already killed the demon!"],[1,"The demon on the top of the tower?\nBut if the gate isn't open...?"],[0,"The top of the tower?\nI killed a demon on my way here."],[1,"You didn't kill the demon, the one you killed might just be a squadron leader."],[1,"The Demon is on the top of the tower.\nI'll open the gate for you."],[1,"The power of the big demon at the top isn't comparable to anything that you've seen before in your life!"],[0,"Then what are you waiting for? Run!"],[1,"What for? To leave you here to die and get me locked up again?\nYou must kill him!"],[0,"Ok, wait here.\nI'll kill that Demon."],[1,"The Demon is not only much stronger, but he can also transform.\nAfter his transformation..."],[1,"his attack and defence will increase immensely.\nBe careful!"],[1,"Please come back safe!"]]},red_devil:{icon:"devil",title:"Devil",ia:[[0,"Die, Demon!"],[1,"Hahaha... You are such a fool."],[1,"Don't think you can beat me just because that fairy butterfly  gave you some power."],[1,"You are still too young!"],[0,"Shut up and die!"]]},chaos_1:{icon:"chaos",title:"Chaos",ia:[[0,"Die, Demon!"],[1,"Hahaha... You are such a fool."],[1,"Don't think you can beat me just because that fairy butterfly  gave you some power."],[1,"You are still too young!"],[0,"Shut up and die!"]]},chaos_1_after:{icon:"chaos",title:"Chaos",ia:[[1,"You've got some skills. Just try to follow me to the 21st floor!"],[1,"There, now you can see my real power!"]]},chaos_2_after:{icon:"chaos",title:"Chaos",ia:[[1,"Ah... How could this be, how could I..."],[1,"...be defeated by you?!\nNo, this can't be..."]]}};var Doc=function(){var Doc=function Doc(){alert("Called the Doc contructor, what has no sense.")};Doc.ja=function appendBoard(){var board=$("#tiles");for(var i=1;i<12;i++)for(var j=1;j<12;j++)board.append('<div class="tile" id="rowcol-'+i+"-"+j+'"></div>')};Doc.load=function load(){Doc.ja();Doc.style();$("#display-fight").hide();$("#mob-screen").hide();$("#shop-container").hide();$("#dialog_warrior").hide();$("#dialog_item").hide();$("#restart-container").hide();$("#beta").hide()};Doc.style=function style(){var $body=$("#warrior #body-container");var $name=$("#warrior #name");$name.css("right",parseFloat($body.css("right"))+parseFloat($body.outerWidth(true))/2-parseFloat($name.outerWidth(false))/2-parseFloat($name.css("margin-right"))+"px");$name.css("top",parseFloat($body.css("top"))+parseFloat($body.outerHeight(true))-parseFloat($name.css("margin-top"))+"px");$body=$("#mob #body-container");$name=$("#mob #name");$name.css("left",parseFloat($body.css("left"))+parseFloat($body.outerWidth(true))/2-parseFloat($name.outerWidth(false))/2-parseFloat($name.css("margin-left"))+"px");$name.css("top",parseFloat($body.css("top"))+parseFloat($body.outerHeight(true))-parseFloat($name.css("margin-top"))+"px");var $game=$("#game-container");var $displaysLeft=$("#displays_left");$game.css("left","26vw");if($game.position().left<$displaysLeft.width())$game.css("left",$displaysLeft.width());var $keysContainer=$("#keys-container");var $keys=$("#keys");$keys.css("top",(parseFloat($keysContainer.height())-parseFloat($keys.height()))/2+"px");var $vol=$("#volume");$vol.css("top",parseFloat($game.css("top"))+parseFloat($game.outerHeight(true))+"px");$vol.css("left",parseFloat($game.css("left"))+parseFloat($game.outerWidth(true))-parseFloat($vol.outerWidth(true))+"px")};return Doc}();$(window).resize(Doc.style);var Music={};Music.ka;Music.la;Music.S=function(floor,oldFloor){if(oldFloor<0||oldFloor>=Music.ka.length||oldFloor===undefined)oldFloor=char.floor;var song=Music.ka[floor];var oldSong=Music.ka[oldFloor];console.log("Setting music for floor "+floor+(oldSong!==undefined?", coming from floor "+oldFloor:""));song.stop();song.play("main");song.volume(0);if(oldSong!==undefined)song.seek(oldSong.seek()<15?oldSong.seek():.5);song.fade(0,1,100);if(oldSong!==undefined)song.once("fade",function(){if(Music.ka[char.floor]!==oldSong){oldSong.volume(0);oldSong.stop()}else{song.volume(0);song.stop()}});var con="At "+song.seek();if(oldSong!==undefined)con+=", the old song was at "+oldSong.seek();if(isNumber(song.seek()))console.log(con)};Music.X=function(floor,duration){floor=floor||newChar.floor;duration=duration||0;var song=Music.ka[floor];song.fade(1,0,duration);song.once("fade",function(){if(Music.ka[char.floor]!==song)song.stop()})};Music._=function(soundName){var sound=Music.la[soundName];sound.volume(sound.volume()-5e-5);Music.la[soundName].play("main")};Music.ma=function(){Music.ka=[];Music.ka[0]=new Howl({src:["./res/sound/floors/floor_0-18.mp3"],sprite:{main:[0,15e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 0")}});Music.ka[1]=new Howl({src:["./res/sound/floors/floor_1.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 1")}});Music.ka[2]=new Howl({src:["./res/sound/floors/floor_2.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 2")}});Music.ka[3]=new Howl({src:["./res/sound/floors/floor_3.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 3")}});Music.ka[4]=new Howl({src:["./res/sound/floors/floor_4-5.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 4")}});Music.ka[5]=new Howl({src:["./res/sound/floors/floor_4-5.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 5")}});Music.ka[6]=new Howl({src:["./res/sound/floors/floor_6-7.mp3"],sprite:{main:[200,16e3]},loop:true,
autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 6")}});Music.ka[7]=new Howl({src:["./res/sound/floors/floor_6-7.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 7")}});Music.ka[8]=new Howl({src:["./res/sound/floors/floor_8-9.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 8")}});Music.ka[9]=new Howl({src:["./res/sound/floors/floor_8-9.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 9")}});Music.ka[10]=new Howl({src:["./res/sound/floors/floor_10.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 10")}});Music.ka[11]=new Howl({src:["./res/sound/floors/floor_11.mp3"],sprite:{main:[200,32400]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 11")}});Music.ka[12]=new Howl({src:["./res/sound/floors/floor_12.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 12")}});Music.ka[13]=new Howl({src:["./res/sound/floors/floor_13.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 13")}});Music.ka[14]=new Howl({src:["./res/sound/floors/floor_14.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 14")}});Music.ka[15]=new Howl({src:["./res/sound/floors/floor_15.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 15")}});Music.ka[16]=new Howl({src:["./res/sound/floors/floor_16.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 16")}});Music.ka[17]=new Howl({src:["./res/sound/floors/floor_17.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 17")}});Music.ka[18]=Music.ka[0];Music.ka[19]=new Howl({src:["./res/sound/floors/floor_19.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 19")}});Music.ka[20]=new Howl({src:["./res/sound/floors/floor_20.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 20")}});Music.ka[21]=new Howl({src:["./res/sound/floors/floor_21.mp3"],sprite:{main:[200,16e3]},loop:true,autoplay:false,html5:true,preload:true,onload:function(){console.log("Finished loading song from floor 21")}});Howler.volume(1)};Music.na=function(){var sounds={};sounds["move"]=new Howl({src:["./res/sound/move.mp3"],sprite:{main:[0,1e4]},loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "move"')},volume:.3});sounds["pick_up_key"]=new Howl({src:["./res/sound/pick_up_key.mp3"],sprite:{main:[100,1e4]},loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "pick_up_key"')}});sounds["pick_up_item"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/pick_up_item.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "pick_up_item"')}});sounds["move_shop"]=new Howl({src:["./res/sound/move_shop.mp3"],sprite:{main:[0,1e4]},loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "move_shop"')}});sounds["exit_shop"]=new Howl({sprite:{main:[100,1e4]},src:["./res/sound/exit_shop.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "exit_shop"')}});sounds["attack_weak"]=new Howl({sprite:{main:[100,1e4]},src:["./res/sound/attack_weak.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "attack_weak"')}});sounds["attack_normal"]=new Howl({sprite:{main:[100,1e4]},src:["./res/sound/attack_normal.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "attack_normal"')}});sounds["attack_strong"]=new Howl({sprite:{main:[100,1e4]},src:["./res/sound/attack_strong.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "attack_strong"')}});sounds["end_fight"]=new Howl({sprite:{main:[100,1e4]},src:["./res/sound/end_fight.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "end_fight"')}});sounds["dialog"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/dialog.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "dialog"')}});sounds["end_fairy_dialog"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/end_fairy_dialog.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "end_fairy_dialog"')}});sounds["too_weak"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/too_weak.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "too_weak"')}});sounds["wind_compass"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/wind_compass.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "wind_compass"')}});sounds["use_stairs"]=new Howl({sprite:{main:[0,1e4]},src:["./res/sound/use_stairs.mp3"],loop:false,autoplay:false,html5:true,preload:true,onload:function(){console.log('Finished loading sound "use_stairs"')}});Music.la=sounds};Music.oa=function(){var val=Cookies.get("volume");if(val!==undefined)$("#volume input").value=val;$("#volume input").on("input",function(e){Music.volume(e.target.value);Cookies.set("volume",e.target.value)})};Music.volume=function(vol){var ret=Howler.volume(vol);return typeof ret==="object"?this:ret};Music.load=function(){Music.ma();Music.na();Music.oa()};$(document).on("keydown.special",function(e){switch(Core.P(e.which)){case"f":fastForward(true);break;case"g":GOD=false;break;case"left":case"right":case"up":case"down":case"enter":e.preventDefault();break}});$(document).on("keyup.special",function(e){switch(Core.P(e.which)){case"f":fastForward(false);break}});var Messages=function Messages(){var Messages=function Messages(){alert("Called the Messages contructor, what has no sense.")};Messages.R=function(open){if(open===false){this.R.open=false;$("#restart-container").hide();disableKeyboard();enableKeyboard();return}if(this.R.open){console.error("Restart confirmation box is already open.");return}this.R.open=true;disableKeyboard();$("#restart-container").show();var option=2;$("#restart-container #option_"+option).addClass("selected");enableKeyboard(function(e){$("#restart-container #option_"+option).removeClass("selected");switch(Core.P(e.which)){case"left":if(option>1)option--;$("#restart-container #option_"+option).addClass("selected");break;case"right":if(option<2)option++;$("#restart-container #option_"+option).addClass("selected");break;case"esc":Messages.R(false);break;case"enter":Messages.R(false);if(option==1)Core.W();break;default:$("#restart-container #option_"+option).addClass("selected");break}})};Messages.R.open=false;Messages.v=function(open){if(open===false){this.v.open=false;$("#tutorial").hide();disableKeyboard();enableKeyboard();return}if(this.v.open){console.error("Tutorial message is already open.");return}this.v.open=true;disableKeyboard();$("#tutorial").show();var autoRemover=setTimeout(function(){disableKeyboard();enableKeyboard();Messages.v(false)},this.v.pa);setTimeout(function(){enableKeyboard(function(){clearInterval(autoRemover);disableKeyboard();enableKeyboard();Messages.v(false)})},2500)};Messages.v.open=false;Messages.v.pa=12e3;Messages.beta=function(open){if(open===false){this.beta.open=false;$("#beta").hide();disableKeyboard();enableKeyboard();return}if(this.beta.open){console.error("Tutorial message is already open.");return}this.beta.open=true;disableKeyboard();$("#beta").show();enableKeyboard(function(e){switch(Core.P(e.which)){case"enter":Messages.beta(false);break}})};Messages.beta.open=false;return Messages}();
})();
